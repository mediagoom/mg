<p>In the beginning you should have a file you want to play in a web page or in a mobile application using adaptive streaming instead of progressive download.</p>

<p>The first thing you need is <a href="https://ffmpeg.org/download.html"><em>ffmpeg</em></a>. A free tool.</p>

<p>The basic command to create each of the needed file should be something similar to:</p>

<h1 id="encode-with-bash">Encode with Bash</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ffmpeg <span class="nt">-i</span> <span class="o">[</span>input file] <span class="nt">-vf</span> <span class="s2">"scale=w=1280:h=720"</span> <span class="se">\</span>
<span class="nt">-codec</span>:v libx264 <span class="nt">-profile</span>:v high <span class="nt">-level</span> 31 <span class="nt">-b</span>:v 750k <span class="se">\</span>
<span class="nt">-r</span> 25 <span class="nt">-g</span> 50 <span class="nt">-sc_threshold</span> 0 <span class="nt">-x264opts</span> <span class="nv">ratetol</span><span class="o">=</span>0.1 <span class="se">\</span>
<span class="nt">-minrate</span> 750k <span class="nt">-maxrate</span> 750k <span class="nt">-bufsize</span> 750k <span class="se">\</span>
<span class="nt">-b</span>:a 96k <span class="nt">-codec</span>:a aac <span class="nt">-profile</span>:a aac_low <span class="nt">-ar</span> 44100 <span class="nt">-ac</span> 2 mg_750.mp4
</code></pre></div></div>
<h1 id="encode-with-powershell">Encode with Powershell</h1>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ffmpeg -i <span class="o">[</span>input file] -vf <span class="s2">"scale=w=1280:h=720"</span> <span class="se">`</span>
-codec:v libx264 -profile:v high -level 31 -b:v 750k <span class="se">`</span>
-r 25 -g 50 -sc_threshold 0 -x264opts <span class="nv">ratetol</span><span class="o">=</span>0.1 <span class="se">`</span>
-minrate 750k -maxrate 750k -bufsize 750k <span class="se">`</span>
-b:a 96k -codec:a aac -profile:a aac_low -ar 44100 -ac 2 mg_750.mp4
</code></pre></div></div>
<p>In the above command this are the parameter used and their explanation:</p>

<ul>
  <li><em>-i</em> This is the input file you want to convert.</li>
  <li><em>-vf</em> with this parameter you define the output size of your file. You should decrease the output size while you decrease the bitrate.</li>
  <li><em>-codec</em> this the codec. You should mainly use <strong>libx264</strong> and <strong>aac</strong>.</li>
  <li><em>-profile</em> and <em>-level</em> this is the h264 profile. For maximum compatibility use <strong>high</strong>.</li>
  <li><em>-b:v</em> this is the video bit rate. You should change this parameter together with the video size for each output file.</li>
</ul>

<h1 id="sample-encoding-session">Sample Encoding Session</h1>

<p>You can use this function to simplify the encoding and setting the file path of the source:</p>
<h2 id="bash-function">Bash Function</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>encode<span class="o">()</span>
<span class="o">{</span>

ffmpeg <span class="nt">-i</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="nt">-vf</span> <span class="s2">"scale=w=</span><span class="nv">$4</span><span class="s2">:h=</span><span class="nv">$5</span><span class="s2">"</span> <span class="nt">-codec</span>:v libx264 <span class="se">\</span>
<span class="nt">-profile</span>:v high <span class="nt">-level</span> 31 <span class="nt">-b</span>:v <span class="s2">"</span><span class="k">${</span><span class="nv">3</span><span class="k">}</span><span class="s2">k"</span> <span class="se">\</span>
<span class="nt">-r</span> 25 <span class="nt">-g</span> 50 <span class="nt">-sc_threshold</span> 0 <span class="nt">-minrate</span> <span class="s2">"</span><span class="k">${</span><span class="nv">3</span><span class="k">}</span><span class="s2">k"</span> <span class="se">\</span>
<span class="nt">-maxrate</span> <span class="s2">"</span><span class="k">${</span><span class="nv">3</span><span class="k">}</span><span class="s2">k"</span> <span class="nt">-bufsize</span> <span class="s2">"</span><span class="k">${</span><span class="nv">3</span><span class="k">}</span><span class="s2">k"</span> <span class="nt">-x264opts</span> <span class="nv">ratetol</span><span class="o">=</span>0.1 <span class="se">\</span>
<span class="nt">-b</span>:a 96k <span class="nt">-codec</span>:a aac <span class="nt">-profile</span>:a aac_low <span class="nt">-ar</span> 44100 <span class="nt">-ac</span> 2 <span class="nt">-strict</span> <span class="nt">-2</span> <span class="se">\</span>
 <span class="s2">"</span><span class="nv">$1_$6x$7_h264</span><span class="s2">-</span><span class="nv">$5Kb_aac</span><span class="s2">-lc.mp4"</span>
<span class="o">}</span>

<span class="nv">f</span><span class="o">=[</span>path to file to encode] 
</code></pre></div></div>

<h2 id="powershell-function">Powershell Function</h2>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">function </span>encode<span class="o">(</span><span class="nv">$n</span>, <span class="nv">$f</span>, <span class="nv">$k</span>, <span class="nv">$w</span><span class="o">=</span>1280, <span class="nv">$h</span><span class="o">=</span>720<span class="o">)</span>
<span class="o">{</span>

ffmpeg -i <span class="s2">"</span><span class="nv">$f</span><span class="s2">"</span> -vf <span class="s2">"scale=w=</span><span class="k">$(</span><span class="nv">$w</span><span class="k">)</span><span class="s2">:h=</span><span class="k">$(</span><span class="nv">$h</span><span class="k">)</span><span class="s2">"</span> -codec:v libx264 <span class="se">`</span>
-profile:v high -level 31 -b:v <span class="s2">"</span><span class="k">$(</span><span class="nv">$k</span><span class="k">)</span><span class="s2">k"</span> <span class="se">`</span>
-r 25 -g 50 -sc_threshold 0 -minrate <span class="s2">"</span><span class="k">$(</span><span class="nv">$k</span><span class="k">)</span><span class="s2">k"</span> -maxrate <span class="s2">"</span><span class="k">$(</span><span class="nv">$k</span><span class="k">)</span><span class="s2">k"</span> <span class="se">`</span>
-bufsize <span class="s2">"</span><span class="k">$(</span><span class="nv">$k</span> <span class="k">*</span> 1<span class="k">)</span><span class="s2">k"</span> <span class="se">`</span>
 -x264opts <span class="nv">ratetol</span><span class="o">=</span>0.1 -b:a 96k -codec:a aac <span class="se">`</span>
-profile:a aac_low -ar 44100 -ac 2 -strict -2 <span class="se">`</span>
<span class="s2">"</span><span class="k">$(</span><span class="nv">$n</span><span class="k">)</span><span class="s2">_</span><span class="k">$(</span><span class="nv">$w</span><span class="k">)</span><span class="s2">x</span><span class="k">$(</span><span class="nv">$h</span><span class="k">)</span><span class="s2">_h264-</span><span class="k">$(</span><span class="nv">$k</span><span class="k">)</span><span class="s2">Kb_aac-lc.mp4"</span>
<span class="o">}</span>

</code></pre></div></div>

<p>With the function defined to produce 6 bitrates you just run:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$file</span><span class="o">=[</span>path to file to encode] 
<span class="nv">$name</span><span class="o">=</span><span class="s2">"test"</span>

encode <span class="nv">$name</span> <span class="nv">$f</span> 120 256 144
encode <span class="nv">$name</span> <span class="nv">$f</span> 320 512 288
encode <span class="nv">$name</span> <span class="nv">$f</span> 750 1024 576
encode <span class="nv">$name</span> <span class="nv">$f</span> 1200 1280 720
encode <span class="nv">$name</span> <span class="nv">$f</span> 2000 1280 720
encode <span class="nv">$name</span> <span class="nv">$f</span> 3500 1024 720
</code></pre></div></div>

<p>Once you have your 6 files you can <a href="./package">generate the dash segments using <strong>mg</strong></a>.</p>
